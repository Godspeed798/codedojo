<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeDojo - ç¼–ç¨‹é“åœº</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div id="app">
        <div v-if="currentView === 'login'" class="login-container">
            <div class="login-box">
                <h1 class="game-title"><i class="ri-code-s-slash-line"></i> CodeDojo</h1>
                <p class="game-subtitle">ç¼–ç¨‹é“åœº - ç®—æ³•ä¿®ä»™ä¹‹è·¯</p>
                <div class="login-form">
                    <input v-model="username" @keyup.enter="login" placeholder="è¾“å…¥ä½ çš„é“å·..." class="input-ninja">
                    <button @click="login" class="btn-ninja btn-primary"><i class="ri-sword-line"></i> è¿›å…¥é“åœº</button>
                </div>
            </div>
        </div>

        <div v-else class="app-container">
            <header class="game-header">
                <div class="header-left">
                    <span class="logo"><i class="ri-code-s-slash-line"></i> CodeDojo</span>
                </div>
                <div class="header-center">
                    <div class="player-stats">
                        <span class="stat"><i class="ri-user-star-line"></i> {{ user.level }}çº§</span>
                        <span class="stat"><i class="ri-fire-line"></i> {{ user.exp }}/{{ expNeeded }} exp</span>
                        <span class="stat gold"><i class="ri-coin-line"></i> {{ user.coins }}</span>
                        <span class="stat"><i class="ri-lightbulb-line"></i> {{ user.hintsToday }}æç¤º</span>
                    </div>
                </div>
                <div class="header-right">
                    <span class="player-name">{{ user.username }}</span>
                </div>
            </header>

            <nav class="game-nav">
                <button @click="currentView = 'lobby'" :class="{active: currentView === 'lobby'}" class="nav-btn">
                    <i class="ri-home-4-line"></i> é“åœºå¤§å…
                </button>
                <button @click="currentView = 'arena'" :class="{active: currentView === 'arena'}" class="nav-btn">
                    <i class="ri-roadster-line"></i> ç®—æ³•ç«æŠ€åœº
                </button>
                <button @click="currentView = 'dungeon'" :class="{active: currentView === 'dungeon'}" class="nav-btn">
                    <i class="ri-dungeon-line"></i> å‰¯æœ¬æŒ‘æˆ˜
                </button>
                <button @click="currentView = 'shop'" :class="{active: currentView === 'shop'}" class="nav-btn">
                    <i class="ri-store-2-line"></i> è£…å¤‡å•†åŸ
                </button>
            </nav>

            <main class="game-main">
                <div v-if="currentView === 'lobby'" class="lobby">
                    <div class="welcome-banner">
                        <h2>æ¬¢è¿å›æ¥ï¼Œ{{ user.username }}é“å‹ï¼</h2>
                        <p>ç»§ç»­ä½ çš„ç®—æ³•ä¿®ä»™ä¹‹è·¯</p>
                    </div>

                    <div class="quick-actions">
                        <div @click="currentView = 'arena'" class="action-card race">
                            <i class="ri-roadster-line"></i>
                            <h3>ç®—æ³•èµ›è½¦</h3>
                            <p>è§‚çœ‹ç®—æ³•ç«é€Ÿæ¯”èµ›</p>
                        </div>
                        <div @click="currentView = 'dungeon'" class="action-card dungeon">
                            <i class="ri-dungeon-line"></i>
                            <h3>æŒ‘æˆ˜å‰¯æœ¬</h3>
                            <p>æ”»å…‹ç¼–ç¨‹éš¾å…³</p>
                        </div>
                        <div @click="currentView = 'shop'" class="action-card shop">
                            <i class="ri-store-2-line"></i>
                            <h3>è£…å¤‡å•†åŸ</h3>
                            <p>å¼ºåŒ–ä½ çš„å®åŠ›</p>
                        </div>
                    </div>

                    <div class="dungeons-preview">
                        <h3><i class="ri-map-line"></i> å‰¯æœ¬åœ°å›¾</h3>
                        <div class="dungeon-list">
                            <div class="dungeon-item free">
                                <div class="dungeon-icon">ğŸŒ²</div>
                                <div class="dungeon-info">
                                    <h4>æ–°æ‰‹æ‘ - åŸºç¡€è¯­æ³•æ£®æ—</h4>
                                    <p>5ä¸ªå…³å¡ | å…è´¹å¼€æ”¾</p>
                                </div>
                                <span class="badge free">å…è´¹</span>
                            </div>
                            <div class="dungeon-item locked">
                                <div class="dungeon-icon">ğŸ”¥</div>
                                <div class="dungeon-info">
                                    <h4>ç«ç„°å±± - ç®—æ³•ç†”ç‚‰</h4>
                                    <p>8ä¸ªå…³å¡ | éœ€è¦è§£é”</p>
                                </div>
                                <span class="badge premium">Â¥6.6</span>
                            </div>
                            <div class="dungeon-item locked">
                                <div class="dungeon-icon">âš”ï¸</div>
                                <div class="dungeon-info">
                                    <h4>æ·±æ¸Š - æ•°æ®ç»“æ„æ·±æ¸Š</h4>
                                    <p>10ä¸ªå…³å¡ | éœ€è¦è§£é”</p>
                                </div>
                                <span class="badge premium">Â¥8.8</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="currentView === 'arena'" class="arena">
                    <div class="arena-header">
                        <h2><i class="ri-roadster-line"></i> ç®—æ³•èµ›è½¦ç«æŠ€åœº</h2>
                    </div>

                    <div class="race-setup">
                        <div class="racer-select">
                            <h3>é€‰æ‹©ä½ çš„èµ›è½¦ï¼ˆç®—æ³•ï¼‰</h3>
                            <div class="racer-options">
                                <div @click="selectedAlgo1 = 'bubble'" :class="{selected: selectedAlgo1 === 'bubble'}" class="racer-option">
                                    <span class="racer-icon">ğŸš—</span>
                                    <div class="racer-info">
                                        <h4>æ–°æ‰‹è½¦ - å†’æ³¡æ’åº</h4>
                                        <p>ç¨³å®šä½†ç¼“æ…¢</p>
                                        <div class="stat-bar"><span class="fill" style="width:30%"></span></div>
                                        <small>é€Ÿåº¦: 30%</small>
                                    </div>
                                </div>
                                <div @click="selectedAlgo1 = 'selection'" :class="{selected: selectedAlgo1 === 'selection'}" class="racer-option">
                                    <span class="racer-icon">ğŸï¸</span>
                                    <div class="racer-info">
                                        <h4>ä¸­çº§è½¦ - é€‰æ‹©æ’åº</h4>
                                        <p>åŠ é€Ÿè¾ƒå¿«</p>
                                        <div class="stat-bar"><span class="fill" style="width:50%"></span></div>
                                        <small>é€Ÿåº¦: 50%</small>
                                    </div>
                                </div>
                                <div @click="selectedAlgo1 = 'quick'" :class="{selected: selectedAlgo1 === 'quick'}" class="racer-option">
                                    <span class="racer-icon">ğŸš€</span>
                                    <div class="racer-info">
                                        <h4>é«˜çº§è½¦ - å¿«é€Ÿæ’åº</h4>
                                        <p>æé€Ÿé£é©°</p>
                                        <div class="stat-bar"><span class="fill" style="width:90%"></span></div>
                                        <small>é€Ÿåº¦: 90%</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="track-select">
                            <h3>é€‰æ‹©èµ›é“ï¼ˆæ•°æ®è§„æ¨¡ï¼‰</h3>
                            <div class="track-options">
                                <div @click="arraySize = 8" :class="{selected: arraySize === 8}" class="track-option">
                                    <span>ğŸ</span>
                                    <div>
                                        <h4>çŸ­èµ›é“</h4>
                                        <p>8ä¸ªå…ƒç´ </p>
                                    </div>
                                </div>
                                <div @click="arraySize = 15" :class="{selected: arraySize === 15}" class="track-option">
                                    <span>ğŸï¸</span>
                                    <div>
                                        <h4>ä¸­èµ›é“</h4>
                                        <p>15ä¸ªå…ƒç´ </p>
                                    </div>
                                </div>
                                <div @click="arraySize = 25" :class="{selected: arraySize === 25}" class="track-option">
                                    <span>ğŸ”ï¸</span>
                                    <div>
                                        <h4>é•¿èµ›é“</h4>
                                        <p>25ä¸ªå…ƒç´ </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="vs-section">
                            <div class="racer-left">
                                <span class="racer-big">{{ getRacerEmoji(selectedAlgo1) }}</span>
                                <h4>{{ getRacerName(selectedAlgo1) }}</h4>
                            </div>
                            <div class="vs-text">VS</div>
                            <div class="racer-right">
                                <span class="racer-big">{{ getRacerEmoji(selectedAlgo2) }}</span>
                                <h4>{{ getRacerName(selectedAlgo2) }}</h4>
                            </div>
                        </div>

                        <button @click="startRace" :disabled="racing" class="btn-ninja btn-race">
                            <i class="ri-play-line"></i> {{ racing ? 'æ¯”èµ›ä¸­...' : 'å¼€å§‹æ¯”èµ›' }}
                        </button>
                    </div>

                    <div v-if="raceResult" class="race-result">
                        <div class="winner-banner" :class="{win: raceResult.winner === selectedAlgo1}">
                            <i class="ri-trophy-line"></i>
                            <h3>{{ raceResult.winner === selectedAlgo1 ? 'ä½ èµ¢äº†ï¼' : 'ä½ è¾“äº†ï¼' }}</h3>
                        </div>
                        <div class="race-stats">
                            <div class="stat-card">
                                <h4>{{ getRacerName(selectedAlgo1) }}</h4>
                                <p class="time">{{ raceResult.time1?.toFixed(2) }}ms</p>
                                <p>{{ raceResult.steps1 }} æ­¥</p>
                            </div>
                            <div class="stat-card">
                                <h4>{{ getRacerName(selectedAlgo2) }}</h4>
                                <p class="time">{{ raceResult.time2?.toFixed(2) }}ms</p>
                                <p>{{ raceResult.steps2 }} æ­¥</p>
                            </div>
                        </div>
                    </div>

                    <div v-if="steps.length > 0" class="visualization">
                        <div class="viz-header">
                            <h3><i class="ri-eye-line"></i> ç®—æ³•å¯è§†åŒ–</h3>
                            <div class="viz-controls">
                                <button @click="prevStep" :disabled="currentStep <= 0"><i class="ri-skip-back-line"></i></button>
                                <button @click="togglePlay" class="play-btn"><i :class="playing ? 'ri-pause-line' : 'ri-play-line'"></i></button>
                                <button @click="nextStep" :disabled="currentStep >= steps.length - 1"><i class="ri-skip-forward-line"></i></button>
                                <span>{{ currentStep + 1 }} / {{ steps.length }}</span>
                            </div>
                        </div>
                        <div class="viz-container">
                            <div class="bars-container">
                                <div v-for="(val, idx) in steps[currentStep]?.data" :key="idx"
                                     class="bar" :style="{height: (val / maxVal * 100) + '%'}"
                                     :class="getBarClass(idx)">
                                    <span class="bar-label">{{ val }}</span>
                                </div>
                            </div>
                            <div class="step-desc">
                                <p>{{ steps[currentStep]?.description }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="currentView === 'dungeon'" class="dungeon-view">
                    <div class="dungeon-header">
                        <h2><i class="ri-dungeon-line"></i> å‰¯æœ¬æŒ‘æˆ˜</h2>
                    </div>

                    <div class="level-tabs">
                        <button @click="selectedType = 'basic'" :class="{active: selectedType === 'basic'}" class="tab-btn">
                            ğŸŒ² æ–°æ‰‹æ‘ï¼ˆå…è´¹ï¼‰
                        </button>
                        <button @click="selectedType = 'sorting'" :class="{active: selectedType === 'sorting'}" class="tab-btn premium-tab">
                            ğŸ”¥ æ’åºç«å±± <span class="lock">ğŸ”’</span>
                        </button>
                        <button @click="selectedType = 'search'" :class="{active: selectedType === 'search'}" class="tab-btn premium-tab">
                            âš”ï¸ æŸ¥æ‰¾åœ°ç‰¢ <span class="lock">ğŸ”’</span>
                        </button>
                    </div>

                    <div class="levels-grid">
                        <div v-for="level in filteredLevels" :key="level.id" @click="selectLevel(level)"
                             :class="{locked: !level.isFree && !hasUnlocked(level.type)}"
                             class="level-card">
                            <div class="level-header">
                                <span class="level-num">{{ level.id }}</span>
                                <span v-if="level.isFree" class="badge free">å…è´¹</span>
                                <span v-else class="badge premium">ä»˜è´¹</span>
                            </div>
                            <h4>{{ level.name }}</h4>
                            <p>{{ level.description }}</p>
                            <div class="level-rewards">
                                <span><i class="ri-fire-line"></i> +{{ level.expReward }} exp</span>
                                <span><i class="ri-coin-line"></i> +{{ level.coinReward }}</span>
                            </div>
                        </div>
                    </div>

                    <div v-if="selectedLevel" class="level-modal">
                        <div class="modal-content">
                            <button @click="selectedLevel = null" class="close-btn"><i class="ri-close-line"></i></button>
                            <h2>{{ selectedLevel.name }}</h2>
                            <p class="level-desc">{{ selectedLevel.description }}</p>
                            <div class="code-area">
                                <h3>ä»£ç åŒºåŸŸ</h3>
                                <textarea v-model="userCode" class="code-editor">{{ selectedLevel.starterCode }}</textarea>
                            </div>
                            <div class="level-actions">
                                <button @click="runLevel" class="btn-ninja btn-run">
                                    <i class="ri-play-line"></i> è¿è¡Œä»£ç 
                                </button>
                                <button @click="useHint" :disabled="user.hintsToday <= 0" class="btn-ninja btn-hint">
                                    <i class="ri-lightbulb-line"></i> æç¤º ({{ user.hintsToday }})
                                </button>
                            </div>
                            <div v-if="runResult" class="run-result" :class="{success: runResult.success, error: !runResult.success}">
                                <pre>{{ runResult.message }}</pre>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="currentView === 'shop'" class="shop-view">
                    <div class="shop-header">
                        <h2><i class="ri-store-2-line"></i> è£…å¤‡å•†åŸ</h2>
                        <p class="player-coins"><i class="ri-coin-line"></i> {{ user.coins }} é‡‘å¸</p>
                    </div>

                    <div class="shop-tabs">
                        <button @click="shopCategory = 'weapons'" :class="{active: shopCategory === 'weapons'}" class="tab-btn">
                            âš”ï¸ æ­¦å™¨
                        </button>
                        <button @click="shopCategory = 'armor'" :class="{active: shopCategory === 'armor'}" class="tab-btn">
                            ğŸ›¡ï¸ é˜²å…·
                        </button>
                        <button @click="shopCategory = 'dungeons'" :class="{active: shopCategory === 'dungeons'}" class="tab-btn">
                            ğŸ—ºï¸ å‰¯æœ¬
                        </button>
                    </div>

                    <div v-if="shopCategory === 'weapons'" class="shop-grid">
                        <div v-for="item in weapons" :key="item.id" class="shop-card" :class="item.rarity">
                            <div class="item-icon">{{ getWeaponIcon(item.id) }}</div>
                            <h4>{{ item.name }}</h4>
                            <p>{{ item.effect }} +{{ item.effectValue }}%</p>
                            <div class="item-price">
                                <span v-if="item.isFree" class="free-tag">å·²æ‹¥æœ‰</span>
                                <span v-else><i class="ri-coin-line"></i> {{ item.price }}</span>
                            </div>
                            <button v-if="!item.isFree" @click="buyItem(item)" class="btn-buy">
                                <i class="ri-shopping-cart-line"></i> è´­ä¹°
                            </button>
                        </div>
                    </div>

                    <div v-if="shopCategory === 'armor'" class="shop-grid">
                        <div v-for="item in armors" :key="item.id" class="shop-card" :class="item.rarity">
                            <div class="item-icon">{{ getArmorIcon(item.id) }}</div>
                            <h4>{{ item.name }}</h4>
                            <p>æ¯æ—¥æç¤º {{ item.effectValue }}æ¬¡</p>
                            <div class="item-price">
                                <span v-if="item.isFree" class="free-tag">å·²æ‹¥æœ‰</span>
                                <span v-else><i class="ri-coin-line"></i> {{ item.price }}</span>
                            </div>
                            <button v-if="!item.isFree" @click="buyItem(item)" class="btn-buy">
                                <i class="ri-shopping-cart-line"></i> è´­ä¹°
                            </button>
                        </div>
                    </div>

                    <div v-if="shopCategory === 'dungeons'" class="dungeon-shop">
                        <div class="dungeon-pack">
                            <span class="pack-icon">ğŸ”¥</span>
                            <h3>æ’åºç«å±±</h3>
                            <p>8ä¸ªæ’åºç®—æ³•å…³å¡</p>
                            <div class="pack-price">Â¥6.6</div>
                            <button @click="showPayment('sorting', 6.6)" class="btn-ninja btn-pay">
                                <i class="ri-wechat-pay-line"></i> è§£é”
                            </button>
                        </div>
                        <div class="dungeon-pack">
                            <span class="pack-icon">âš”ï¸</span>
                            <h3>æŸ¥æ‰¾åœ°ç‰¢</h3>
                            <p>8ä¸ªæœç´¢ç®—æ³•å…³å¡</p>
                            <div class="pack-price">Â¥8.8</div>
                            <button @click="showPayment('search', 8.8)" class="btn-ninja btn-pay">
                                <i class="ri-wechat-pay-line"></i> è§£é”
                            </button>
                        </div>
                        <div class="dungeon-pack bundle">
                            <span class="ribbon">è¶…å€¼</span>
                            <span class="pack-icon">ğŸ</span>
                            <h3>å‰¯æœ¬å¤§ç¤¼åŒ…</h3>
                            <p>è§£é”æ‰€æœ‰å‰¯æœ¬ + é™å®šç§°å·</p>
                            <div class="pack-price"><s>Â¥15.4</s> Â¥15</div>
                            <button @click="showPayment('all', 15)" class="btn-ninja btn-pay">
                                <i class="ri-wechat-pay-line"></i> è§£é”
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <div v-if="showPayModal" class="payment-modal">
            <div class="modal-content pay-modal">
                <button @click="showPayModal = false" class="close-btn"><i class="ri-close-line"></i></button>
                <h2><i class="ri-wechat-pay-line"></i> å¾®ä¿¡æ”¯ä»˜</h2>
                <div class="qr-area">
                    <img src="/images/qr.png" alt="å¾®ä¿¡æ”¶æ¬¾ç " class="qr-image">
                    <p class="price">Â¥{{ payAmount }}</p>
                </div>
                <div class="payment-form">
                    <input v-model="transactionId" placeholder="è¾“å…¥å¾®ä¿¡æ”¯ä»˜è®¢å•å·å6ä½" class="input-ninja">
                    <button @click="submitPayment" class="btn-ninja btn-pay">
                        <i class="ri-check-line"></i> æˆ‘å·²æ”¯ä»˜
                    </button>
                </div>
                <p class="pay-note">æ”¯ä»˜åï¼Œç®¡ç†å‘˜å°†å°½å¿«å®¡æ ¸å¹¶è§£é”å†…å®¹</p>
            </div>
        </div>
    </div>

    <script src="/js/app.js"></script>
</body>
</html>
